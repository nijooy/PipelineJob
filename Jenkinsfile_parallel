pipeline {
    agent none

    stages {
        stage('Parallel Build & Test') {
            parallel {
                stage('Build on Agent1') {
                    agent { label 'agent1' }
                    steps {
                        script {
                            bat '''
                              @echo off
                              chcp 65001 >nul
                              echo Running build on Agent1...
                              timeout /T 5 /NOBREAK >nul
                              echo Build on Agent1 completed!
                            '''
                        }
                    }
                }

                stage('Test on Agent2') {
                    agent { label 'agent2' }
                    steps {
                        script {
                            bat '''
                              @echo off
                              chcp 65001 >nul
                              echo Running tests on Agent2...
                              timeout /T 5 /NOBREAK >nul
                              echo Tests on Agent2 completed!
                            '''
                        }
                    }
                }
            }
        }
    }
}
