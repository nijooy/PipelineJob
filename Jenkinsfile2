node {
    stage('Checkout') {
        git branch: 'main', url: 'https://github.com/nijooy/PipelineJob.git'
    }

    stage('Build') {
        try {
            bat 'npm install'
        } catch (e) {
            error "빌드 실패: ${e}"
        }
    }

    stage('Test') {
        def testPassed = bat(script: 'npm test', returnStatus: true)
        if (testPassed != 0) {
            error '테스트 실패!'
        }
    }

    stage('Deploy') {
        // 단일 브랜치이므로 그냥 실행
        bat 'npm start'
    }
}
